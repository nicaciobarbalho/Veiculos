@using Veiculos.Web.Models
@model VendaModel

@{
    ViewBag.Title = "Vender";
}

<div class="container">
    <div class="row">
        <div class="col-md-8 col-lg-offset-1">
            <section id="IdVender">
                
                <div class="panel panel-default" style="margin-top:3% !important;">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            Vender
                        </h3>
                    </div>

                    <div class="panel-body">
                        <div class="row center-block">
                            @using (Html.BeginForm("RegistrarVenda", "Vender", FormMethod.Post, new { @class = "form-horizontal", role = "form", id = "submitForm" }))
                            {

                                @Html.AntiForgeryToken()
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })


                                <div class="form-group">
                                    <div class="col-sm-3 control-label" style="text-align:left;">
                                        @Html.LabelFor(model => model.Data, htmlAttributes: new { @class = "left" })
                                    </div>
                                    <div class="col-sm-9">
                                        @Html.EditorFor(model => model.Data, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.Data, "", new { @class = "text-danger", })
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-3 control-label" style="text-align:left;">
                                        @Html.LabelFor(model => model.Desconto, htmlAttributes: new { @class = "left" })
                                    </div>
                                    <div class="col-sm-9">
                                        @Html.EditorFor(model => model.Desconto, new { htmlAttributes = new { @class = "form-control required numeric", @style = "text-align:right;" } })
                                        @Html.ValidationMessageFor(model => model.Desconto, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-3 control-label" style="text-align:left;">
                                        @Html.LabelFor(model => model.Comissao, htmlAttributes: new { @class = "left" })
                                    </div>
                                    <div class="col-sm-9">
                                        @Html.EditorFor(model => model.Comissao, new { htmlAttributes = new { @class = "form-control required numeric", @style = "text-align:right;" } })
                                        @Html.ValidationMessageFor(model => model.Comissao, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-3 control-label" style="text-align:left;">
                                        @Html.Label("", "Observação", htmlAttributes: new { @class = "left" })
                                    </div>
                                    <div class="col-sm-9">
                                        @Html.TextAreaFor(model => model.Obs, htmlAttributes: new { @class = "form-control" })
                                        @Html.ValidationMessageFor(model => model.Obs, "", new { @class = "text-danger" })
                                    </div>
                                </div>

                                
                                <div id="FormaPagamento">

                                    <div class="panel panel-default" style="margin-top:3% !important;">
                                        <div class="panel-heading">
                                            <h3 class="panel-title">
                                                Forma de Pagamento
                                            </h3>
                                        </div>

                                        <div class="panel-body">
                                            <div class="row center-block">
                                              
                                                <div class="form-group">
                                                    <div class="col-sm-3 control-label" style="text-align:left;">
                                                        @Html.Label("", "Forma de pagamento", htmlAttributes: new { @class = "left" })
                                                    </div>
                                                    <div class="col-sm-9">
                                                        @Html.DropDownList("IdFormaPagamento", ViewBag.IdFormaPagamento as SelectList, htmlAttributes: new { @class = "form-control" })                                                        
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <div class="col-sm-3 control-label" style="text-align:left;">
                                                        @Html.Label("", "Valor", htmlAttributes: new { @class = "left" })
                                                    </div>
                                                    <div class="col-sm-9">
                                                        @Html.Editor("IdValor", new { htmlAttributes = new { @class = "form-control required numeric", @style = "text-align:right;" } })
                                                    </div>

                                                    <div class="col-sm-3 col-sm-offset-3 control-label" style="text-align:left;">

                                                        <div id="btnAddBook" class="btn icon-btn btn-success" onclick="addRow();">
                                                            <span class="glyphicon btn-glyphicon glyphicon-plus img-circle text-success"></span>
                                                            Adicionar
                                                        </div>
                                                    </div>
                                                    <br /><br /><br /><br />
                                                    <table class="table" id="IdTabelaFormaPagamento" style="display:none;">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col">#</th>
                                                                <th scope="col">Forma de Pagamento</th>
                                                                <th scope="col">Valor</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="tbBooks"></tbody>
                                                    </table>

                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="form-group">
                                    <div class="col-sm-9">
                                        <input type="submit" value="Salvar" class="btn btn-default" />
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>

<script language="javascript" type="text/javascript">
        function addRow() {

            @{
                Model.Pagamentos.Add(new PagamentoModel());
            }

            var index = $("#tbBooks").children("tr").length + 1;
            var idFormaPagamento = $("#IdFormaPagamento option:selected").val();
            var txtFormaPagamento = $("#IdFormaPagamento option:selected").text();
            var valor = $("#IdValor").val();

            var indexCell = "<td scope='row'><input name='Pagamentos.Index' type='hidden' value='" + index + "' />" + index + "</td>";
            var formaPagamentoCell = "<td><input id='Pagamentos_" + index + "__IdFormaPagamento' name='Pagamentos[" + index + "].IdFormaPagamento' type='hidden' value='" + idFormaPagamento + "' />" + txtFormaPagamento + "</td>";
            var valorCell = "<td><input id='Pagamentos_" + index + "__IdFormaPagamento' name='Pagamentos[" + index + "].Quantia' type='hidden' value='" + valor + "' />" + valor + "</td>";            
            var removeCell = "<td><div id='btnAddBook' class='btn icon-btn btn-warning' onclick='removeRow(" + index + ");'><span class='glyphicon btn-glyphicon glyphicon-minus img-circle text-warning'></span>Remover</div></td>";

            var newRow = "<tr id='trBook" + index + "'>" +
                indexCell + formaPagamentoCell + valorCell + removeCell + "</tr>";
            $("#tbBooks").append(newRow);
            tabelaVisivel();
        }

        function removeRow(id) {
            var controlToBeRemoved = "#trBook" + id;
            $(controlToBeRemoved).remove();
            tabelaVisivel();
    }

    function tabelaVisivel() {

        var index = $("#tbBooks").children("tr").length;
        if (index > 0) {
            $("#IdTabelaFormaPagamento").attr("style", "display:normal");
        } else {
            $("#IdTabelaFormaPagamento").attr("style", "display:none");
        }
    }
</script>